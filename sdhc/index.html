<!DOCTYPE html>
<html lang=en><head>
  <meta charset=utf-8 />
  <title>Tomato firmware with SDHC mod</title>
  <link rel=schema.dcterms href='http://purl.org/dc/terms/'>
  <meta name=description content='Modified Tomato firmware for Linksys WRT54G/GS/GL routers with SDHC cards internal storage support added (with GUI)' />
  <meta name=keywords content='Tomato,firmware,wrt54g,linksys,mmc,mod,sdhc,sd,card' />
  <meta name=author content='Tomasz Słodkowicz' />
  <meta name=web-author content='Tomasz Słodkowicz' />
  <meta name=designer content='Tomasz Słodkowicz' />
  <meta name=dcterms.modified content=2017-05-19 />
  <meta name=dcterms.created content=2009-02-11 />
  <meta name=viewport content='width=device-width, initial-scale=1.0' />
  <link rel=icon href='/favicon.ico?' sizes='16x16 24x24 32x32' type=image/vnd.microsoft.icon />
  <link rel=stylesheet href=../main.css />
  <link rel=stylesheet href=../tomato.css />
</head>
<body>
  <header><h1>Tomato firmware with SDHC mod</h1></header>

  <h2>Description</h2>
  <p>This is a firmware for <a href='http://www.linksys.com/us/p/P-WRT54GL/'>Linksys
  routers</a> based on great <a href='https://en.wikipedia.org/wiki/Tomato_(firmware)'>Tomato firmware</a> with
  additional <a href='http://en.wikipedia.org/wiki/Secure_Digital_card'><abbr title='Secure Digital'>SD</abbr></a>,
  <a href='http://en.wikipedia.org/wiki/Secure_Digital_card#SDHC'><abbr title='Secure Digital High Capacity'>SDHC</abbr></a>,
  <a href='http://en.wikipedia.org/wiki/Multimedia_Card'><abbr title='Multimedia Card'>MMC</abbr></a> cards support.</p>

  <h3>Features</h3>
  <ul>
    <li>All great features of Tomato firmware ver. 1.28</li>
    <li>New optimized SDHC/MMC driver ver. 2.0.1 - this adds up to 32GB build-in storage on flash memory</li>
    <li>Higher transfers then previous mmc driver (ver. 1.3.5): +40% writing, +10% reading</li>
    <li><abbr title='General Purpose Input/Output'>GPIO</abbr> pins parametres selectable via <abbr title='Graphical User Interface'>GUI</abbr></li>
    <li>Detailed card ID data avaiable via GUI</li>
    <li>Support for mounting
      <a href='https://en.wikipedia.org/wiki/Ext2'><abbr title='second extended filesystem'>ext2</abbr></a>,
      <a href='https://en.wikipedia.org/wiki/Ext3'><abbr title='third extended filesystem'>ext3</abbr></a>
      and <a href='https://en.wikipedia.org/wiki/File_Allocation_Table#VFAT'><abbr title='Virtual File Allocation Table'>vfat</abbr></a> partitions</li>
  </ul>

  <h3>Supported hardware</h3>
  <p>Should be the same as original Tomato firmware:</p>
  <ul>  <li>Linksys WRT54G v1-v4, WRT54GS v1-v4, WRT54GL v1.x, WRTSL54GS (no USB support)</li>
    <li>Buffalo WHR-G54S, WHR-HP-G54, WZR-G54, WBR2-G54, WBR-G54, WZR-HP-G54, WZR-RS-G54, WZR-RS-G54HP,
    WVR-G54-NF, WHR2-A54-G54, WHR3-AG54</li>
    <li>Asus WL500G Premium (no USB support), WL500GE, WL520GU (no USB support)</li>
    <li>Sparklan WX6615GT, Fuji RT390W, Microsoft MN-700</li>
  </ul>
  <p>I'm not sure if all above routers support SDHC/MMC hardware mod. This version of SDHC/MMC driver
  may not work with other then Linksys WRT54G/GS/GL routers.</p>
  <p>For routers with <abbr title='Universal Serial Bus'>USB</abbr> ports you should use firmware with USB support - it has a higher
  transfer then SDHC/MMC in <abbr title='Serial Peripheral Interface'>SPI</abbr> (slow) mode.</p>

  <h3>Screenshot</h3>
  <p><a href=tomato-sdhc.png><img src=tomato-sdhc.png height=362 alt='GUI webpage'/></a></p>
  <p>Example SDHC card initialization log (from syslog):</p>
<pre><samp>[INF] mmc: Version: 2.0.1  Parms: major=121 din=2 dout=4 clk=3 cs=7 maxsec=32 rahead=2 dbg=0001
[DBG] mmc: init: power on/insertion initialization...
[DBG] mmc: init: CMD0 - reset...
[DBG] mmc: init SD: CMD8 - CIC voltage range check...
[DBG] mmc: init SD: CMD58 - OCR voltage range check...
[DBG] mmc: init SD: ACMD41 - card initialization...
[DBG] mmc: init SD: CMD58 - Card Capacity Status check...
[DBG] mmc: init SD: CMD10 - Card Identification Register read...
[DBG] mmc: init SD: CMD9 - Card Specific Data read...
[DBG] mmc: init SD: ACMD51 - SD Config Register read...
[INF] mmc: SD Card detected & initialized
[DBG] mmc: init - CMD16 - set 512 byte blocksize...
Partition check:
 mmca: p1
[INF] mmc: Module loaded</samp></pre>

  <h3>Benchmarks</h3>
  <p>Testing method:</p>
<pre><samp><kbd># mount -t ext3 /dev/mmc/disc0/part1 /mmc
# sync; date; dd if=/dev/zero of=/mmc/test.bin bs=1024 count=102400; sync; date
# sync; date; dd if=/mmc/test.bin of=/dev/null bs=1024 count=102400; sync; date</kbd></samp></pre>

  <p>Results (WRT54GL v1.1 with SD mod, clkfreq=225):</p>
    <table><tr><th rowspan=2>Card tested</th><th colspan=2>SD driver v1.3.5</th>
      <th colspan=2>SDHC driver v2.0.1</th><th colspan=2>USB 2.0 card reader (PC)</th></tr>
      <tr><th>write</th><th>read</th><th>write</th><th>read</th><th>write</th><th>read</th></tr>
      <tr><td>Kingston microSD 2GB</td><td>404 KB/s</td><td>446 KB/s</td><td>572 KB/s</td><td>474 KB/s</td><td>8 MB/s</td><td>18 MB/s</td></tr>
      <tr><td>Toshiba SDHC 4GB</td><td colspan=2></td><td>781 KB/s</td><td>451 KB/s</td><td>13 MB/s</td><td>18.2 MB/s</td></tr>
    </table>

  <h2>Authors</h2>
  <ul>  <li>Jonathan Zarate - original <a href='http://www.polarcloud.com/tomato'>Tomato firmware</a></li>
    <li>Augusto Bott - original Tomato SD/MMC mod</li>
    <li>Roadkill - <a href='http://www.linksysinfo.org/forums/showthread.php?t=53233'>
    Roadkill OpenVPN Mod</a> with SD/MMC support</li>
    <li>Keith Moyer - <a href='http://tomatovpn.keithmoyer.com/'>TomatoVPN</a> mod</li>
    <li>Fedor Kozhevnikov and Ray Van Tassle - <a href='http://tomatousb.org/'>TomatoUSB</a> mod</li>
    <li>Chris Krusch - new <a href='https://dev.openwrt.org/ticket/6343'>SDHC/MMC driver</a></li>
    <li>Tomasz Słodkowicz - merging new SDHC driver into Tomato and GUI update</li>
  </ul>

  <h2>Documentation and links</h2>
  <ul>
    <li>Hardware SD modification instructions for <a href='http://duff.dk/sd/'>WRT54G</a>, <a href='http://beta.ivc.no/wiki/index.php/Adding_SD_card_to_WRT54GL'>WRT54GL</a>, <a href='https://wiki.openwrt.org/toh/linksys/wrt54g/gpio'>WRT54G, WRT54GS, WRT54GL, WHR-HP-G54, WAP54G, Fonera AP</a>, <a href='https://wiki.openwrt.org/oldwiki/openwrtdocs/hardware/buffalo/whr_g54s/sd_mmc_hack'>WHR-G54S</a></li>
    <li>SDHC/MMC v2.0.1 <a href='http://repo.or.cz/w/tomato.git?a=blob;f=release/src/router/mmc/mmc.c;hb=tomato-sdhc'>driver documentation</a> (parameters, tuning etc.)</li>
    <li>Tomato <a href='http://www.polarcloud.com/tomatofaq'><abbr title='frequently asked questions'>FAQ</abbr></a> and <a href='http://en.wikibooks.org/wiki/Tomato_Firmware'>Wikibook</a></li>
    <li>LinksysInfo <a href='http://www.linksysinfo.org/forums/forumdisplay.php?f=160'>Tomato
    forum</a> (with info about different <a href='http://www.linksysinfo.org/forums/showthread.php?t=57933'>Tomato modifications</a> avaiable)</li>
    <li><a href='http://victek.is-a-geek.com/virtual/tomatok26'>Simulator</a> for Tomato RAF mod (without SDHC support)</li>
  </ul>

  <h2>Download</h2>
  <strong>This firmware is provided as-is without any warranty. I will not be responsible for damages that
  occur due to the use of this firmware. Use at your own risk!</strong>
  <p>The binary firmware files are compressed in <a href='http://en.wikipedia.org/wiki/7z'>7z</a> format.
  You could also download <a href='http://www.bitsum.com/firmware_mod_kit.htm'>Firmware Modification Kit</a>
  to extract the binary firmware or even to repack it with additional or modified files!</p>

  <h3 id=tomato-slodki>tomato-slodki</h3>
  <p>This is Tomato firmware with SDHC/MMC support added and many others improvements. The 1.25.01 and 1.28.01 versions
  have additional features from <a href='http://tomatovpn.keithmoyer.com/'>TomatoVPN</a> mod.
  The 1.28.02 version is copy of <a href='http://tomatousb.org/'>TomatoUSB</a> 1.28.8754
  (<a href='http://tomatousb.org/doc:build-features-cross-reference'>build e</a>) with SDHC support and without <abbr title='Journaling Flash File System'>JFFS</abbr>.
  For details see changelog.</p>
  <ul>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-slodki-ND-1.28.02'>tomato-slodki-ND-1.28.02</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-slodki-ND-1.28.02'>changelog</a>)</li>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-slodki-ND-1.28.01'>tomato-slodki-ND-1.28.01</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-slodki-ND-1.28.01'>changelog</a>)</li>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-slodki-1.25.01'>tomato-slodki-1.25.01</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-slodki-1.25.01'>changelog</a>)</li>
  </ul>
  <h3 id=tomato-sdhc>tomato-sdhc</h3>
  <p>This is clean original Tomato firmware with SDHC/MMC support added.</p>
  <ul>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-sdhc-ND-1.28.01'>tomato-sdhc-ND-1.28.01</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-sdhc-ND-1.28.01'>changelog</a>)</li>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-sdhc-1.28.01'>tomato-sdhc-1.28.01</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-sdhc-1.28.01'>changelog</a>)</li>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-sdhc-1.25.01'>tomato-sdhc-1.25.01</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-sdhc-1.25.01'>changelog</a>)</li>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-sdhc-1.23.02'>tomato-sdhc-1.23.02</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-sdhc-1.23.02'>changelog</a>)</li>
    <li><a href='https://github.com/slodki/tomato/releases/tag/tomato-sdhc-1.23.01'>tomato-sdhc-1.23.01</a>
    (<a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/tags/tomato-sdhc-1.23.01'>changelog</a>)</li>
  </ul>

  <h3>Sources</h3>
  <p>Sources for this version of Tomato firmware are avaiable at the git repository for
  <a href='http://repo.or.cz/w/tomato.git?a=tree;h=refs/heads/tomato-sdhc;hb=tomato-slodki'>on-line browsing</a>,
  all <a href='http://repo.or.cz/w/tomato.git?a=shortlog;h=refs/heads/tomato-slodki'>changes can be listed</a> there too.
  For compiling instruction please read
  <a href='http://repo.or.cz/w/tomato.git?a=blob_plain;f=README.TXT;hb=tomato'>README.TXT</a> file.
  For git commands - please see the <a href='http://git-scm.com/documentation'>tutorials</a> at Git homepage.</p>

  <p>Possible future improvements (not implemented):</p>
  <ul>
    <li>Autodetection of partition type</li>
    <li>Allow to mount more then 1 partition</li>
    <li>Add fsck and run it before mounting</li>
  </ul>

  <footer><small>
  <abbr title=Copyright>©</abbr> <time datetime=2009-02-11>2009</time>-<time datetime=2017-05-19>2017</time> Tomasz Słodkowicz. All rights reserved.<br />
  Last updated <time datetime=2017-05-19>2017-05-19</time>, visits: <a href='http://www.licz.pl' title='Darmowe Liczniki'>
  <script src='http://www.licz.pl/counter.php?name=tomatosdhc' type=text/javascript></script></a>
  <a href='http://www.licz.pl'><img src='http://www.licz.pl/donotalterthecode.gif' width=5 height=5 alt=''/></a>
  </small></footer>
</body>
</html>
